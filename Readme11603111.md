# Semi-Supervised Brain Tumor Segmentation Using a Box-Constrained Loss in a 2D U-Net

**Author: Shreya Abraham Varghese**\
**Course: Msc. Advanced Computer Science in Artificial Intelligence**\
**Primary file:** 11603111\_code.ipynb

## 1) External Compute: Kaggle (from account creation)

These steps let the marker reproduce everything on Kaggle using a GPU P100.

1. **Create a Kaggle account** (kaggle.com) and verify your email and phone number for GPU access.
2. Go to **Code → Notebooks → New Notebook**.
3. Click the Settings panel (top‑right). Under **Accelerator**, choose **GPU** → **P100**.
4. In the **Data** panel (right sidebar), click **+ Add data** and attach the dataset brats-2021-task1. It will appear under `/kaggle/input/brats-2021-task1` inside the runtime.
5. **Upload** `.ipynb`  to the notebook or copy‑paste its content into a new notebook cell‑for‑cell.
6. Optional Install any missing packages (Kaggle often preinstalls these):
   ```bash
   pip install -q nibabel scikit-image tensorflow tqdm
   ```
7. Click **Run All**. The notebook performs: data extraction → preprocessing → staged training → evaluation → visualization → artifact saving.

## 2) How to compile the code

Python notebooks are interpreted so no compilation step is required. TensorFlow builds graphs.

## 3) How to run the code&#x20;

On Kaggle, simply **Run All**.&#x20;

## 4) How to prepare the input data

The notebook expects BraTS 2021 Task 1 `.tar` case archives under:

```
/kaggle/input/brats-2021-task1
```

On first run, it automatically:

- **Extracts** all `.tar` archives into `Constants.WORKING_PATH` (default: `/kaggle/working/brats2021`).
- **Preprocesses** volumes into `.npz` files organized as:
  - `/kaggle/working/preprocessed/pretrain_train`
  - `/kaggle/working/preprocessed/pretrain_val`
  - `/kaggle/working/preprocessed/box_train`
  - `/kaggle/working/preprocessed/box_val`

**Modalities used:** `FLAIR`, `T1CE`, `T2`. Masks are read from `*_seg.nii.gz`. Slices are resized to `TARGET_SIZE=(128,128)`.

If you run locally, place the `.tar` files in a path equivalent to `Constants.INPUT_PATH` or edit that constant at the top of the notebook.

## 5) How to obtain the data from your code (outputs & where to find them)

All artifacts are written under:

```
/kaggle/working
```

Key outputs include:

- **Models/weights**
  - `encoder_pretrain_imagenet_compat.weights.h5`
  - `boxy_prior_model.h5`
- **Figures**
  - `final_batch_visualization.png`
  - `result_<CASE_ID>_final_boxy.png`

### Downloading from Kaggle

- Use the **Output** panel → **Download** for files in `/kaggle/working`.

## 6) What the notebook does (high level)

1. **Data extraction & preprocessing** from `.tar` BraTS cases.
2. **Stage 1 – Supervised pretraining**: encoder initialized with ImageNet‑compatible backbone; trains with standard pixel‑wise loss & Dice.
3. **Stage 2 – Box‑constrained fine‑tuning**: starts with the encoder **frozen**, then unfreezes; optimizes a combined loss with box/“boxy prior” terms.
4. **Evaluation & visualization**: logs loss & Dice; produces qualitative overlays and batch visualizations for sanity checks.

## 7) Dependencies

Minimal set used by the notebook:

- `tensorflow` (Keras API)
- `nibabel`
- `scikit-image`
- `numpy`, `matplotlib`, `tqdm` (Plus Python stdlib: `glob`, `os`, `tarfile`, `time`.)

## 8) Academic integrity & acknowledgements

- Dataset: **BraTS 2021 Task 1** ([https://www.kaggle.com/datasets/dschettler8845/brats-2021-task1](https://www.kaggle.com/datasets/dschettler8845/brats-2021-task1)).

## 9) GitHub Link

[https://github.com/sv8911/Semi-Supervised-Brain-Tumor-Segmentation-Using-a-Box-Constrained-Loss-in-a-2D-U-Net/new/main?filename=README.md](https://github.com/sv8911/Semi-Supervised-Brain-Tumor-Segmentation-Using-a-Box-Constrained-Loss-in-a-2D-U-Net/new/main?filename=README.md)

